/* D3 page. */
app.get('/d3', function(req, res, next) { // route for '/'

	var json_PO = null;
	var json_PackingList = null;
	var json_BillList = null;
	var json_ItemReceipt = null;
	
	var pl_name = new Array();
	var pl_id = new Array();
	var pl_status = new Array();
	var pl_date = new Array();
	var plChild = new Array();
	
	var ir_name = new Array();
	var ir_id = new Array();
	var ir_status = new Array();
	var ir_date = new Array();
	
	var vb_name = new Array();
	var vb_id = new Array();
	var vb_status = new Array();
	var vb_date = new Array();
	
	var billChild = new Array();
	var poChild = new Array();
	
	var poParent = null;
	
	
	
	
	if(id)
	{
	console.log("Data Driven Documents View");
	
	console.log("vendor_id  " + id);
	
	var fields_PackingListContents= {key:"po_ns_id",operator:"=",value:'5172',key1:"VENDOR_NS_ID::integer",operator1:"=",value1:id};
	dbs.query('packing_list',fields_PackingListContents);
	dbs.readData(function (result){
		
		
		if(result!=''){
		
		for (var i=0; i<result.length; i++) 
		{
			pl_id[i] = result[i].packing_list_ns_id; 
			pl_status[i] =result[i].status;
			pl_date[i]= result[i].date_created;
			poChild.push({name:"Packing List",assigned:"Packing List::"+pl_id[i],date:pl_date[i],status:pl_status[i]});
			billChild.push({name:"Packing List",assigned:"Packing List::"+pl_id[i],date:pl_date[i],status:pl_status[i]});
		}
				
		}
		//poParent = {name:"Purchase Order",assigned:"Purchase Order::5172",children:plChild};
		//console.log("after poParent : "+poParent);
		
});
	
	var fields_ItemReceiptContents= {key:"purchase_order_id",operator:"=",value:'5172',key1:"VENDOR_NS_ID::integer",operator1:"=",value1:id};
	dbs.query('Item_Receipt',fields_ItemReceiptContents);
	dbs.readData(function (result){
		
		
		if(result!=''){
		
		for (var i=0; i<result.length; i++) 
		{
			ir_id[i] = result[i].ns_id; 
			//ir_status[i] =result[i].status;
			ir_date[i]= result[i].created_date;
			poChild.push({name:"Item Receipt",assigned:"Item Receipt::"+ir_id[i],date:ir_date[i]});
			
		}
				
		}
				
});
	
	var fields_VendorBillContents= {key:"po_id",operator:"=",value:'5172',key1:"VENDOR_NS_ID::integer",operator1:"=",value1:id};
	dbs.query('bill_list',fields_VendorBillContents);
	dbs.readData(function (result){
		
		
		if(result!=''){
		
		for (var i=0; i<result.length; i++) 
		{
			vb_id[i] = result[i].bill_list_ns_id; 
			vb_status[i] =result[i].status;
			vb_date[i]= result[i].bill_date;
			
			poChild.push({name:"Bill",assigned:"Bill::"+vb_id[i],date:vb_date[i],status:vb_status[i],children:billChild});
			
		}
				
		}
				
});
	
	
	
	
	poParent = {name:"Purchase Order",assigned:"Purchase Order::5172",children:poChild};
	console.log("after poParent : "+poParent);

	
	 setTimeout(function () {
		res.render('d3',{
			tran_po:poParent
		});},5000);
	
	
	  }
else
{
	res.render('signout',{});
}
});
