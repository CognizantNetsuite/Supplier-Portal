var pg = require('pg');


// global namespace
var dba = dba || {};

	// vendor type enumeration
	const dbVendor = {
			Sqlite: 'SQLITE',
			Postgress: 'POSTGRESS',
			MySQL: 'MYSQL',
		}

	// db
	module.exports.db = function (dbVendor) {
		
	  this.dbVendor = dbVendor;
	  console.log(dbVendor+" db passed");
	  console.log('DB vendor initialized');
	
	};
	
	// query values
	module.exports.field = function(key,value,operator){
		this.key = key;
		this.value = value;
		this.operator = operator
	}
	
	// main query object
	module.exports.query = function(table,fields){
		
		this.table = table;
		this.fields = fields;
	}
	
	
	
	module.exports.read = function(){
		
		console.log("in DB read");
	
var query_result=null;	
		if(this.dbVendor == dbVendor.Sqlite){
			
		}else if (this.dbVendor == dbVendor.Postgress){
			
		var conString = process.env.DATABASE_URL ;
		var client = new pg.Client(conString);
		client.connect();	
			
				var contents_po_all_count= client.query("select * from "+this.table , function(err, result) {
      				console.log('rows pushed' + result.rows[0]);
      				query_result=result;
      				console.log("contents_po_all_count insisde func"+JSON.stringify(contents_po_all_count));
    				});
				console.log("contents_po_all_count "+JSON.stringify(contents_po_all_count));
			/*	var rows = [];
				contents_po_all_count.on("row", function(row) {
				console.log("rows pushed :: " + JSON.stringify(row));
				rows.push(row);
				});
				
				
			
				contents_po_all_count.on("end", function(result) {
					
					 console.log(result.rowCount + ' rows were received');
					  console.log(result.rows[0] + ' result received');
					
					//query_result=result;
				});
			*/	
				//console.log("contents_po_all_count2 "+JSON.stringify(contents_po_all_count));

				
     
			
			
		}else if (this.dbVendor == dbVendor.MySQL){
			
		}
		
		console.log('Query_result :: ' + query_result.rowCount);
		//console.log('Rows value :: ' + JSON.stringify(rows));
		return query_result;
	client.end();
	}
	
	
	
	/*db.prototype.init = function() {
		
		console.log("DB initialized");
		
	};

	
	
	
	
	 db.prototype.write = function(query){
		
		console.log("in DB write");
		
		if(this.dbVendor == dba.dbVendor.Sqlite){
			
		}else if (this.dbVendor == dba.dbVendor.Postgress){
			
		}else if (this.dbVendor == dba.dbVendor.MySQL){
			
		}
	}
	
	db.prototype.update = function(query){
		
		console.log("in DB update");
		
		if(this.dbVendor == dba.dbVendor.Sqlite){
			
		}else if (this.dbVendor == dba.dbVendor.Postgress){
			
		}else if (this.dbVendor == dba.dbVendor.MySQL){
			
		}
	}
	
	db.prototype.delete = function(query){
		
		console.log("in DB delete");
		
		if(this.dbVendor == dba.dbVendor.Sqlite){
			
		}else if (this.dbVendor == dba.dbVendor.Postgress){
			
		}else if (this.dbVendor == dba.dbVendor.MySQL){
			
		}
	}
	 */
/* // test namespace
var dbaTest = dbaTest || {};

dbaTest.read(){
	
	var myDB = new dba.db(dba.dbVendor.Postgress);
	var myQuery = new dba.query();
	var field1 = new dba.field();
	var field2 = new dba.field();
	
	// add fields
	field1.key = "NAME";
	field1.value = "janakan";
	field1.operator = "=";
	
	field2.key = "COMPANY";
	field2.value = "cognizant";
	field2.operator = "=";
	
	var fields[];
	fields.push(field1);
	fields.push(field2);
	
	// create query object
	myQuery.table = "EMPLOYEE";
	myQuery.fields = fields;
	
	// call db operation
	myDB.read(myQuery);
	
	
} */
	
